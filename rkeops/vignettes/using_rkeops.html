<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content />

<meta name="date" content="2020-01-07" />

<title>Using RKeOps</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using RKeOps</h1>
<h4 class="date">2020-01-07</h4>


<div id="TOC">
<ul>
<li><a href="#install-rkeops">Install RKeOps</a><ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#install-from-cran">Install from CRAN</a></li>
<li><a href="#install-from-sources">Install from sources</a></li>
<li><a href="#get-sources-and-install-from-local-repository">Get sources and install from local repository</a></li>
</ul></li>
<li><a href="#using-rkeops">Using RKeOps</a><ul>
<li><a href="#example">Example</a></li>
<li><a href="#formula">Formula</a></li>
<li><a href="#arguments">Arguments</a><ul>
<li><a href="#input-matrix">Input matrix</a></li>
<li><a href="#notations">Notations</a></li>
</ul></li>
<li><a href="#creating-a-new-operator">Creating a new operator</a></li>
<li><a href="#run-computations">Run computations</a></li>
<li><a href="#computing-gradients">Computing gradients</a></li>
<li><a href="#rkeops-options">RKeOps options</a><ul>
<li><a href="#compile-options">Compile options</a></li>
<li><a href="#runtime-options">Runtime options</a></li>
</ul></li>
<li><a href="#advanced-use">Advanced use</a><ul>
<li><a href="#precision">Precision</a></li>
<li><a href="#data-storage-orientation">Data storage orientation</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<p>RKeOps is a R front-end for the KeOps C++/Cuda library. It provides standard functions that can be used in any R code.<br><br></p>
<p>Thanks to RKeOps, you can use <strong>GPU computing directly inside R</strong> without the cost of developing a specific CUDA implementation of your custom mathematical operators.</p>
<div id="install-rkeops" class="section level1">
<h1>Install RKeOps</h1>
<div id="requirements" class="section level2">
<h2>Requirements</h2>
<ul>
<li>R (tested with R &gt;= 3.5)</li>
<li>Cmake (&gt;=3.10)</li>
<li>C++ compiler (g++ &gt;=7 or clang) for CPU computing or CUDA compiler (nvcc &gt;=10) and CUDA libs for GPU computing</li>
</ul>
</div>
<div id="install-from-cran" class="section level2">
<h2>Install from CRAN</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;rkeops&quot;</span>)</a></code></pre></div>
</div>
<div id="install-from-sources" class="section level2">
<h2>Install from sources</h2>
<ul>
<li>Install directly from Github (requires <code>git</code>)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_git</span>(<span class="st">&quot;https://github.com/getkeops/keops&quot;</span>, </a>
<a class="sourceLine" id="cb2-2" data-line-number="2">                      <span class="dt">subdir =</span> <span class="st">&quot;rkeops&quot;</span>, </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                      <span class="dt">args=</span><span class="st">&quot;--recurse-submodules=</span><span class="ch">\&quot;</span><span class="st">keops/lib/sequences</span><span class="ch">\&quot;</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># not possible to use `devtools::intall_github()` because of the required submodule</span></a></code></pre></div>
</div>
<div id="get-sources-and-install-from-local-repository" class="section level2">
<h2>Get sources and install from local repository</h2>
<ul>
<li>Get KeOps sources (bash command)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="fu">git</span> clone --recurse-submodules=<span class="st">&quot;keops/lib/sequences&quot;</span> https://github.com/getkeops/keops</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"># or</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="fu">git</span> clone https://github.com/getkeops/keops</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="bu">cd</span> keops</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="fu">git</span> submodule update --init -- keops/lib/sequences</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co"># other submodules are not necessary for RKeOps</span></a></code></pre></div>
<ul>
<li>Install from local source in R (assuming you are in the <code>keops</code> directory)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;rkeops&quot;</span>)</a></code></pre></div>
<hr />
</div>
</div>
<div id="using-rkeops" class="section level1">
<h1>Using RKeOps</h1>
<p>Load RKeOps in R:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(rkeops)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">## You are using rkeops version 1.3</span></a></code></pre></div>
<p>RKeOps allows to define and compile new operators that run computations on GPU.</p>
<div id="example" class="section level2">
<h2>Example</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># implementation of a convolution with a Gaussian kernel</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">formula =<span class="st"> &quot;Sum_Reduction(Exp(-s * SqNorm2(x - y)) * b, 0)&quot;</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co"># input arguments</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">args =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x = Vi(3)&quot;</span>,      <span class="co"># vector indexed by i (of dim 3)</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">         <span class="st">&quot;y = Vj(3)&quot;</span>,      <span class="co"># vector indexed by j (of dim 3)</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">         <span class="st">&quot;b = Vj(6)&quot;</span>,      <span class="co"># vector indexed by j (of dim 6)</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">         <span class="st">&quot;s = Pm(1)&quot;</span>)      <span class="co"># parameter (scalar) </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co"># compilation</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">op &lt;-<span class="st"> </span><span class="kw">keops_kernel</span>(formula, args)</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co"># data and parameter values</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">nx &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12">ny &lt;-<span class="st"> </span><span class="dv">150</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>nx)   <span class="co"># matrix 100 x 3</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14">Y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>ny)   <span class="co"># matrix 150 x 3</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">B &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">6</span>), <span class="dt">nrow=</span>ny)   <span class="co"># matrix 150 x 6</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16">s &lt;-<span class="st"> </span><span class="fl">0.2</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co"># run computations on GPU (to be used only if relevant)</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="kw">use_gpu</span>()</a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co"># computation (order of the input arguments should be similar to `args`)</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20">res &lt;-<span class="st"> </span><span class="kw">op</span>(<span class="kw">list</span>(X, Y, B, s))</a></code></pre></div>
<p>The different elements (formula, arguments, compilation, computation) in the previous example will be detailled in the next sections.</p>
</div>
<div id="formula" class="section level2">
<h2>Formula</h2>
<p>To use RKeOps and define new operators, you need to write the corresponding <em>formula</em> which is a text string defining a composition of mathematical operations. It should be characterized by two elements:</p>
<ol style="list-style-type: decimal">
<li><p>a composition of generic functions applied to some input matrices, whose one of their dimensions is either indexed by <span class="math inline">\(i=1,...,M\)</span> or <span class="math inline">\(j=1,...,N\)</span></p></li>
<li><p>a reduction over indexes <span class="math inline">\(i=1,...,M\)</span> (row-wise) or <span class="math inline">\(j=1,...,N\)</span> (column-wise) of the <span class="math inline">\(M \times N\)</span> matrix whose entries are defined by 1.</p></li>
</ol>
<p>RKeOps implements a wide range of mathematical operators and reduction: please refers to <a href="https://www.kernel-operations.io/keops/api/math-operations.html" class="uri">https://www.kernel-operations.io/keops/api/math-operations.html</a> for more details.<br><br></p>
<p><strong>Example:</strong> We want to implement the following kernel-based reduction (convolution with a Gaussian kernel): <span class="math display">\[\sum_{j=1}^{N} \exp\Big(-\sigma || \mathbf x_i - \mathbf y_j ||_2^{\,2}\Big)\,\mathbf b_j\]</span> with</p>
<ul>
<li><p>parameter: <span class="math inline">\(\sigma\in\mathbb R\)</span><br></p></li>
<li><p><span class="math inline">\(i\)</span>-indexed variables <span class="math inline">\([\mathbf x_i]_{i=1,...,M} \in\mathbb R^{M\times 3}\)</span><br></p></li>
<li><p><span class="math inline">\(j\)</span>-indexed variables <span class="math inline">\([\mathbf y_j]_{j=1,...,N} \in\mathbb R^{N\times 3}\)</span> and <span class="math inline">\([\mathbf b_j]_{j=1,...,N} \in\mathbb R^{N\times 6}\)</span><br><br></p></li>
</ul>
<p>In R, we can define the corresponding KeOps formula as a simple <strong>text string</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">formula =<span class="st"> &quot;Sum_Reduction(Exp(-s * SqNorm2(x - y)) * b, 0)&quot;</span></a></code></pre></div>
<ul>
<li><code>SqNorm2</code> = squared <span class="math inline">\(\ell_2\)</span> norm</li>
<li><code>Exp</code> = exponential</li>
<li><code>Sum_reduction(..., 0)</code> = sum reduction over the dimension 0 i.e. sum on the <span class="math inline">\(j\)</span>’s (1 to sum over the <span class="math inline">\(i\)</span>’s)<br></li>
</ul>
</div>
<div id="arguments" class="section level2">
<h2>Arguments</h2>
<p>The formula describing your computation can take several input arguments: variables and parameters. The input variables will generally corresponds to rows or columns of your data matrices, you need to be cautious with their dimensions.</p>
<div id="input-matrix" class="section level3">
<h3>Input matrix</h3>
<p>You can use two type of input matrices with RKeOps:<br></p>
<ul>
<li><p>ones whose rows (or columns) are indexed by <span class="math inline">\(i=1,...,M\)</span> such as <span class="math inline">\(\mathbf X = [x_{ik}]_{M \times D}\)</span><br></p></li>
<li><p>others whose rows (or columns) are indexed by <span class="math inline">\(j=1,...,N\)</span> such as <span class="math inline">\(\mathbf Y = [y_{ik'}]_{N \times D'}\)</span><br><br></p></li>
</ul>
<p>The dimensions over indexes <span class="math inline">\(i\)</span> or <span class="math inline">\(j\)</span> are called the <strong>outer dimensions</strong> (i.e. <span class="math inline">\(M\)</span> or <span class="math inline">\(N\)</span>). The other dimensions (i.e. <span class="math inline">\(D\)</span> or <span class="math inline">\(D'\)</span>) are called the <strong>inner dimensions</strong>. These terms refer to the contiguity of the data in memory:<br></p>
<ul>
<li><p><strong>Outer dimensions</strong> <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> (over indexes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> respectively) can be <strong>very large</strong>, even to large for GPU memory.<br></p></li>
<li><p><strong>Inner dimensions</strong> <span class="math inline">\(D\)</span> and <span class="math inline">\(D'\)</span> should be <strong>small</strong> enough to fit in GPU memory, in particular to ensure data colocality and avoid useless memory transfers. Corresponding columns (or rows) should be contiguous in memory (this point is handled for you in RKeOps, see this <a href="rkeops_r_bindings_for_keops.html#data-storage-orientation">section</a>).<br></p></li>
</ul>
<blockquote>
<p><strong><em>Note 1:</em></strong> The outer dimension can correspond to the rows or the columns of the input matrices (and vice-versa for the inner dimension). The optimal orientation of input matrices is discussed in this <a href="rkeops_r_bindings_for_keops.html#data-storage-orientation">section</a> .</p>
</blockquote>
<blockquote>
<p><strong><em>Note 2:</em></strong> All matrices indexed by <span class="math inline">\(i\)</span> should have the same outer dimension <span class="math inline">\(M\)</span> over <span class="math inline">\(i\)</span>, same for all matrices indexed by <span class="math inline">\(j\)</span> (outer dimension <span class="math inline">\(N\)</span>). Only the inner dimensions <span class="math inline">\(D\)</span> and <span class="math inline">\(D'\)</span> should be known for the compilation of your operators. The respective outer dimensions <span class="math inline">\(M\)</span> and <span class="math inline">\(N\)</span> are set at runtime (and can change from one run to another).<br></p>
</blockquote>
</div>
<div id="notations" class="section level3">
<h3>Notations</h3>
<p>Input arguments of the formula are defined by using keywords, they can be of different types:</p>
<table>
<thead>
<tr class="header">
<th align="left">keyword</th>
<th align="left">meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>Vi</code></td>
<td align="left">variable indexed by <code>i</code></td>
</tr>
<tr class="even">
<td align="left"><code>Vj</code></td>
<td align="left">variable indexed by <code>j</code></td>
</tr>
<tr class="odd">
<td align="left"><code>Pm</code></td>
<td align="left">parameter</td>
</tr>
</tbody>
</table>
<p>You should provide a vector of text string specifying the name and the type of all arguments in your formula.</p>
<p>Each keyword takes as parameter the inner dimension of the corresponding object. For instance, to define an input variable indexed by <span class="math inline">\(i\)</span> corresponding to a <span class="math inline">\(D\)</span>-dimensional vector, you can use <code>&quot;Vi(D)&quot;</code>, same for a <span class="math inline">\(D\)</span>-dimensional variable indexed by <span class="math inline">\(j\)</span> being <code>&quot;Vj(D)&quot;</code> or a <span class="math inline">\(D\)</span>-dimensional parameter <code>&quot;Pm(D)&quot;</code>.<br><br></p>
<p>The vector of arguments should be</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">args =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&lt;name1&gt;=&lt;type1&gt;(dim1)&quot;</span>, <span class="st">&quot;&lt;name2&gt;=&lt;type2&gt;(dim2)&quot;</span>, <span class="st">&quot;&lt;nameX&gt;=&lt;typeX&gt;(dimX)&quot;</span>)</a></code></pre></div>
<p>where</p>
<ul>
<li><code>&lt;nameX&gt;</code> is the name</li>
<li><code>&lt;type1&gt;</code> is the type (among <code>Vi</code>, <code>Vj</code> or <code>Pm</code>)</li>
<li><code>&lt;dimX&gt;</code> is the <strong>inner dimension</strong></li>
</ul>
<p>of the <code>X</code><span class="math inline">\(^\text{th}\)</span> variable in the formula.<br><br></p>
<blockquote>
<p><strong><em>Important:</em></strong> The names should correspond to the ones used in the formula. The input parameter order will be the one used when calling the compiled operator.</p>
</blockquote>
<p><strong>Example:</strong> We define the corresponding arguments of the previous <a href="rkeops_r_bindings_for_keops.html#formula">formula</a>, i.e. parameters or variables indexed by <span class="math inline">\(i\)</span> or <span class="math inline">\(j\)</span> with their corresponding inner dimensions:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">args =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x = Vi(3)&quot;</span>,      <span class="co"># vector indexed by i (of dim 3)</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">         <span class="st">&quot;y = Vj(3)&quot;</span>,      <span class="co"># vector indexed by j (of dim 3)</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">         <span class="st">&quot;b = Vj(6)&quot;</span>,      <span class="co"># vector indexed by j (of dim 6)</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">         <span class="st">&quot;s = Pm(1)&quot;</span>)      <span class="co"># parameter (scalar) </span></a></code></pre></div>
</div>
</div>
<div id="creating-a-new-operator" class="section level2">
<h2>Creating a new operator</h2>
<p>By using the function <code>keops_kernel</code>, based on the formula and its arguments that we previously defined, we can compile and load into R the corresponding operator:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># compilation</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">op &lt;-<span class="st"> </span><span class="kw">keops_kernel</span>(formula, args)</a></code></pre></div>
<p>Calling <code>keops_kernel(formula, args)</code> returns a function that can be later used to run computations on your data with your value of parameters. You should only be cautious with the similarity of each argument inner dimension.<br><br></p>
<p>The returned function (here <code>op</code>) expects a list of input values in the order specified in the vector <code>args</code>.</p>
<p>The result of compilation (shared library file) is stored on the system and will be reused when calling again the function <code>keops_kernel</code> on the same formula with the same arguments and the same conditions (e.g. precision), to avoid useless recompilation.</p>
</div>
<div id="run-computations" class="section level2">
<h2>Run computations</h2>
<p>We generate data with inner dimensions (number of columns) corresponding to each arguments expected by the operator <code>op</code>. The function <code>op</code> takes in input a list of input arguments. If the list if named, <code>op</code> checks the association between the supplied names and the names of the formula arguments. In this case only, it can also correct the order of the input list to match the expected order of arguments.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># data and parameter values</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">nx &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">ny &lt;-<span class="st"> </span><span class="dv">150</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>nx)   <span class="co"># matrix 100 x 3</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">Y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>ny)   <span class="co"># matrix 150 x 3</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">B &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">6</span>), <span class="dt">nrow=</span>ny)   <span class="co"># matrix 150 x 6</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">s &lt;-<span class="st"> </span><span class="fl">0.2</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co"># run computations on GPU (to be used only if relevant)</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="kw">use_gpu</span>()</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co"># computation (order of the input arguments should be similar to `args`)</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">res &lt;-<span class="st"> </span><span class="kw">op</span>(<span class="kw">list</span>(x, y, beta, s))</a></code></pre></div>
</div>
<div id="computing-gradients" class="section level2">
<h2>Computing gradients</h2>
<p>You can define gradients directly in the formula, e.g.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># defining a formula with a Gradient</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">formula &lt;-<span class="st"> &quot;Grad(Sum_Reduction(SqNorm2(x-y), 0), x, eta)&quot;</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">args &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x=Vi(0,3)&quot;</span>, <span class="st">&quot;y=Vj(1,3)&quot;</span>, <span class="st">&quot;eta=Vi(2,1)&quot;</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># compiling the corresponding operator</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">op &lt;-<span class="st"> </span><span class="kw">keops_kernel</span>(formula, args)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co"># data</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">nx &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9">ny &lt;-<span class="st"> </span><span class="dv">150</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>nx, <span class="dt">ncol=</span><span class="dv">3</span>)     <span class="co"># matrix 100 x 3</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11">y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>ny, <span class="dt">ncol=</span><span class="dv">3</span>)     <span class="co"># matrix 150 x 3</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12">eta &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">1</span>), <span class="dt">nrow=</span>nx, <span class="dt">ncol=</span><span class="dv">1</span>)   <span class="co"># matrix 100 x 1</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co"># computation</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15">input &lt;-<span class="st"> </span><span class="kw">list</span>(x, y, eta)</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">res &lt;-<span class="st"> </span><span class="kw">op</span>(input)</a></code></pre></div>
<p>where <code>eta</code> is the new variable at which the gradient is computed, its dimension should correspond to the output dimension of the operation inside the gradient (here <code>SqNorm2(x-y)</code> is of dimension 1).</p>
<p>You can also use the function <code>keops_grad</code> to derive existing KeOps operators.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># defining an operator (reduction on squared distance)</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">formula &lt;-<span class="st"> &quot;Sum_Reduction(SqNorm2(x-y), 0)&quot;</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">args &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x=Vi(0,3)&quot;</span>, <span class="st">&quot;y=Vj(1,3)&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">op &lt;-<span class="st"> </span><span class="kw">keops_kernel</span>(formula, args)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co"># defining its gradient regarding x</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">grad_op &lt;-<span class="st"> </span><span class="kw">keops_grad</span>(op, <span class="dt">var=</span><span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co"># data</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">nx &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10">ny &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11">x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>nx, <span class="dt">ncol=</span><span class="dv">3</span>)     <span class="co"># matrix 100 x 3</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12">y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>ny, <span class="dt">ncol=</span><span class="dv">3</span>)     <span class="co"># matrix 150 x 3</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">eta &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">1</span>), <span class="dt">nrow=</span>nx, <span class="dt">ncol=</span><span class="dv">1</span>)   <span class="co"># matrix 100 x 1</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co"># computation</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16">input &lt;-<span class="st"> </span><span class="kw">list</span>(x, y, eta)</a>
<a class="sourceLine" id="cb13-17" data-line-number="17">res &lt;-<span class="st"> </span><span class="kw">grad_op</span>(input)</a></code></pre></div>
<p><strong>Note:</strong> when defining a gradient, the operator created by <code>keops_grad</code>requires an additional variable whose inner dimension corresponds to the output dimension of the derived formula (here <code>SqNorm2(x-y)</code> is a real-valued function, hence dimension 1) and outer dimension corresponds to the outer dimension of the variable regarding which the gradient is taken (here <code>x</code>).</p>
</div>
<div id="rkeops-options" class="section level2">
<h2>RKeOps options</h2>
<p>RKeOps behavior is driven by specific options in <code>R</code> global options scope. Such options are set up when loading RKeOps (i.e. by calling <code>library(rkeops)</code>).</p>
<p>You can get the current values of RKeOps options with</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">get_rkeops_options</span>()</a></code></pre></div>
<p>To (re)set RKeOps options to default values, run:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">set_rkeops_options</span>()</a></code></pre></div>
<p>To set a specific option with a given value, you can do:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">set_rkeops_option</span>(option, value)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co"># `option` = text string, name of the option to set up</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co"># `value` = whatever value to assign to the chosen option</span></a></code></pre></div>
<p>Check <code>?set_rkeops_option</code> for more details.</p>
<div id="compile-options" class="section level3">
<h3>Compile options</h3>
<ul>
<li><code>use_cuda_if_possible</code>: by default, user-defined operators are compiled for GPU if CUDA is available (and compiled for CPU otherwise).</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># enable compiling for GPU if available (not necessary if using default options)</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">compile4gpu</span>()</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co"># or equivalently</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="kw">set_rkeops_option</span>(<span class="st">&quot;use_cuda_if_possible&quot;</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co"># disable compiling for GPU</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw">set_rkeops_option</span>(<span class="st">&quot;use_cuda_if_possible&quot;</span>, <span class="dv">0</span>)</a></code></pre></div>
<ul>
<li><code>precision</code>: by default, user-defined operators are compiled to use float 32bits for computations (faster than float 64bits or double, compensated sum is available to reduce errors inherent to float 32bits operations)</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">set_rkeops_option</span>(<span class="st">&quot;precision&quot;</span>, <span class="st">&quot;float&quot;</span>)    <span class="co"># float 32bits (default)</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">set_rkeops_option</span>(<span class="st">&quot;precision&quot;</span>, <span class="st">&quot;double&quot;</span>)   <span class="co"># float 64bits</span></a></code></pre></div>
<ul>
<li>other compile options (including boolean value for to enable verbosity or to add debugging flag), see <code>?compile_options</code></li>
</ul>
</div>
<div id="runtime-options" class="section level3">
<h3>Runtime options</h3>
<ul>
<li>GPU computing: by default, RKeOps runs computations on CPU (even for GPU-compiled operators). To enable GPU computing, you can run (before calling your operator):</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">use_gpu</span>()</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co"># see `?runtime_options` for a more advanced use of GPU inside RKeOps</span></a></code></pre></div>
<ul>
<li><code>device_id</code>: choose on which GPU the computations will be done, default is 0.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">set_rkeops_option</span>(<span class="st">&quot;device_id&quot;</span>, <span class="dv">0</span>)</a></code></pre></div>
<blockquote>
<p><strong><em>Note</em></strong>: We recommend to handle GPU assignation outside RKeOps, for instance by setting the environment variable <code>CUDA_VISIBLE_DEVICES</code>. Thus, you can keep the default GPU device id = 0 in RKeOps.</p>
</blockquote>
<ul>
<li>Other runtime options, see <code>?runtime_options</code></li>
</ul>
</div>
</div>
<div id="advanced-use" class="section level2">
<h2>Advanced use</h2>
<div id="precision" class="section level3">
<h3>Precision</h3>
<p>By default, RKeOps uses float 32bits precision for computations. Since R only considers 64bits floating point numbers, your data will be casted when calling your RKeOps operators. If your application requires to use float 64bits (double) precision, keep in mind that you will suffer a performance loss (potentially not an issue on high-end GPUs). In any case, compensated summation reduction will be soon available in KeOps to correct for 32bits floating point arithmetic errors.</p>
</div>
<div id="data-storage-orientation" class="section level3">
<h3>Data storage orientation</h3>
<p>In R, matrices are stored using a column-major order, meaning that a <span class="math inline">\(M \times D\)</span> matrix is stored in memory as a succession of <span class="math inline">\(D\)</span> vectors of length <span class="math inline">\(M\)</span> representing each of its columns. A consequence is that two successive entries of a column are contiguous in memory, but two successive entries of a row are separated by <span class="math inline">\(M\)</span> elements. See this <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">page</a> for more details.<br><br></p>
<p>For RKeOps to be computationnally efficient, it is important that elements of the input matrices are contiguous along the inner dimensions <span class="math inline">\(D\)</span> (or <span class="math inline">\(D'\)</span>). Thus, it is recommended to use input matrices where the outer dimension (i.e. indexes <span class="math inline">\(i\)</span> or <span class="math inline">\(j\)</span>) are the columns, and inner dimensions the rows, e.g. transpose matrices <span class="math inline">\(\mathbf X^{t} = [x_{ki}]_{D \times M}\)</span> or <span class="math inline">\(\mathbf Y^{t} = [y_{k'i}]_{D' \times N}\)</span>.</p>
<blockquote>
<p><strong><em>Important:</em></strong> In machine learning and statistics, we generally use data matrices where each sample/observation/individual is a row, i.e. matrices where the outer dimensions correspond to rows, e.g. <span class="math inline">\(\mathbf X = [x_{ik}]_{M \times D}\)</span>, <span class="math inline">\(\mathbf Y = [y_{ik'}]_{N \times D'}\)</span>.<br><br> This is the default using case of RKeOps. RKeOps will then automatically convert your matrices to their transpose, where the outer dimensions correspond to columns.<br><br> If you want to use matrices where the inner_dimension directly corresponds to rows of your matrices, i.e. <span class="math inline">\(\mathbf X^{t} = [x_{ki}]_{D \times M}\)</span> or <span class="math inline">\(\mathbf Y^{t} = [y_{k'i}]_{D' \times N}\)</span>, you just need to specify the input parameter <code>inner_dim=0</code> when calling your operator.</p>
</blockquote>
<p>Example:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># standard column reduction of a matrix product</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">op &lt;-<span class="st"> </span><span class="kw">keops_kernel</span>(<span class="dt">formula =</span> <span class="st">&quot;Sum_Reduction((x|y), 1)&quot;</span>,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">                   <span class="dt">args =</span> <span class="kw">c</span>(<span class="st">&quot;x=Vi(3)&quot;</span>, <span class="st">&quot;y=Vj(3)&quot;</span>))</a>
<a class="sourceLine" id="cb21-4" data-line-number="4"></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="co"># data (inner dimension = columns)</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6">nx &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">ny &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co"># x_i = rows of the matrix X</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>nx, <span class="dt">ncol=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co"># y_j = rows of the matrix Y</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11">Y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span>ny, <span class="dt">ncol=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co"># computing the result (here, by default `inner_dim=1` and columns corresponds</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="co"># to the inner dimension)</span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14">res &lt;-<span class="st"> </span><span class="kw">op</span>(<span class="kw">list</span>(X,Y))</a>
<a class="sourceLine" id="cb21-15" data-line-number="15"></a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="co"># data (inner dimension = rows)</span></a>
<a class="sourceLine" id="cb21-17" data-line-number="17">nx &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18">ny &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb21-19" data-line-number="19"><span class="co"># x_i = columns of the matrix X</span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(nx<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span><span class="dv">3</span>, <span class="dt">ncol=</span>nx)</a>
<a class="sourceLine" id="cb21-21" data-line-number="21"><span class="co"># y_j = columns of the matrix Y</span></a>
<a class="sourceLine" id="cb21-22" data-line-number="22">Y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(ny<span class="op">*</span><span class="dv">3</span>), <span class="dt">nrow=</span><span class="dv">3</span>, <span class="dt">ncol=</span>ny)</a>
<a class="sourceLine" id="cb21-23" data-line-number="23"><span class="co"># computing the result (we specify `inner_dim=0` to indicate that rows</span></a>
<a class="sourceLine" id="cb21-24" data-line-number="24"><span class="co"># corresponds to the inner dimension)</span></a>
<a class="sourceLine" id="cb21-25" data-line-number="25">res &lt;-<span class="st"> </span><span class="kw">op</span>(<span class="kw">list</span>(X,Y), <span class="dt">inner_dim=</span><span class="dv">0</span>)</a></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
